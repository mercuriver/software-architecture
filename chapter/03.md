# 3 모듈성

- 모듈성은 암묵적 아키텍처 특성 중 하나다, 코드베이스를 잘 발전시키기 위해서는 암묵적으로 질서와 일관성이 필요하다
- 선택한 개발 플랫폼에서 모듈성과 그것을 구현하는 수많은 코드를 이해하는 것은 매우 중요하다
- 모듈성은 일종의 구성 원리(Organizing principle)이다
- 소프트웨어 시스템은 엔트로피(Entropy,무질서)가 증가하는 복잡한 시스템을 모델링한다
- 아키텍트는 끊임없이 에너지를 소비해서 시스템을 구조적으로 탄탄하게 유지해야한다

## 3.1 정의

> 복잡한 구조를 만드는 데 쓰이는 각각의 표준화한 부품이나 독립적인 단위

- 모듈성을 이용해 객체 지향 언어의 클래스나 함수형 언어의 함수가 될만한 서로 연관된 코드를 논리적으로 묶는다
- 이키텍트는 개발자가 코드를 어떻게 패키징하는지 반드시 알아야 한다
  - 여러 패키지가 서로 단단히 커플링되어있으면 재사용성이 매우 낮아진다
- 일반적으로 클래스, 함수와 같이 코드를 묶은 덩어이를 모듈성이라는 용어로 표현한다
  - 이것은 논리적인 구분이지 물리적인 구분이 아니다
  - 모듈의 덩어리가 클 경우 아키텍처를 재구축할 때 커플링된 구조로 인해 어려움을 겪게 된다

## 3.2 모듈성 측정

- 모듈성은 아키텍트에게 매우 중요한 주제다
- 핵심 개념 `응집`, `커플링`, `커네이선스`

### 3.2.1 응집

- 서로 연관된 기능을 동일한 모듈 안에 포함하는 것이다
- 이상적인 경우 모든 파트(구성 요소)가 한 모듈에 함께 패키징될 것이다
- 파트를 더 잘개 쪼개면 모듈 간 호출이 발생한다

> 응집된 모듈을 나누려고 해봐야 더 커플링되고 가독성은 떨어진다
>
> - 래리 콘스탄틴 Larry Constantine

응집도 리스트 (좋음 -> 나쁨 순 정렬 )

1. 기능적 응집 Functional cohesion
   모듈의 각 파트가 다른 파트와 연관되어 있고 기능상 꼭 필요한 모든 것이 모듈에 포함된 것
2. 순차적 응집 Sequential cohesion
   두 모듈이, 한쪽이 데이터를 출력하면 다른 한쪽이 그것을 입력 받는 형태의 상호작용을 하는 것
3. 소통적 응집 Communication cohesion
   두 모듈이, 각각의 흐름대로 동작하고 출력을 발생하는 형태로 통신 체인을 형성하는 것
4. 절차적 응집 Procedural cohesion
   두 모듈이, 정해진 순서대로 실행되는 것
5. 일시적 응집 Temporal cohesion
   모듈이 시점 의존성(Timing dependency)에 따라 연관되는 것
   - 가령, 초기화에 필요한 시, 그다지 연관이 없는 것들도 함께 초기화하는 경우 이를 일시적으로 응집됐다고 표현 함
6. 논리적 응집 Logical cohesion
   모듈의 내부 데이터가 기능적이 아니라 논리적으로 연관되어있는 것
   - 가령, Java StringUtils 패키지와 같이 텍스트, 직렬화 객체, 스트림 데이터 복호화와 같이 서로 하는 일이 모두 다른 연관된 작업
7. 동시적 응집 Coincidental cohesion
   한 모듈 구성 요소에 들어있지만 아무 관련이 없는 것, 가장 나쁜 응집의 형태

응집도 설계 시 고려 사항(트레이드오프)

- 분리된 모듈이 너무 적은 기능을 수행한다면 합치는 편이 좋다
- 앞으로 계속 확장될 기능의 집합인가?
- 개발자가 모듈 내 기능을 추출하여 사용할 일이 많은가?
- 분리된 모듈과 모듈이 서로에 대한 많은 정보를 알고 있어야 하는가?

### 3.2.2 커플링

- 구심(Afferent) 커플링: 컴포넌트, 클래스, 함수 등 코드 아티팩트로 유입되는 접속 수
- 원심(Efferent) 커플링: 다른 코드 아티팩트로 유출되는 접속 수

- 구심 커플링과 원심 커플링의 비율을 통해 불안정도를 파악할 수 있다
  - 원심 커플링(외부로 나가는)가 많을수록 불안정도가 높아지며, 외부와의 커플링이 높아져 복잡도가 올라간다

### 3.2.3 추상도, 불안정도, 메인 시퀀스로부터의 거리

- 추상도: 구현 대비 추상화 정도, 추상 아티팩트(추상 클래스, 인터페이스 등)와 구상 아티팩트(구현체)의 비율
  - 추상도가 낮으면 구현 코드가 늘어 중복과 코드베이스가 커진다
  - 추상도가 높으면 복잡도가 올라간다

### 3.2.4 메인 시퀀스로부터의 거리

- 아키텍처 구조를 평가하는 매트릭 지표를 다룸, 자세한 내용은 78p 참조

### 3.2.5 커네이선스 Connascence

> 커네이선스 Connascence: 변화 종속성
>
> 어느 한쪽을 바꾸면 다른 쪽도 함께 바꾸어야 전체적으로 정합성이 유지되는 상태

> 두 컴포넌트 중 한쪽이 변경될 경우 다른 쪽도 변경해야 전체 시스팀의 정합성이 맞는다면 이들은 커네이선스를 갖고 있는 것이다
>
> - 밀러 페이지-존스

- 정적 커네이선스
  `일시적 응집 Temporal cohesion`의 정반대로, 소스 코드 레벨의 커플링을 뜻한다
  아키텍트는 구심적이든 원심적이든 정적 커네이선스란 다른 무언가와 커플링된 정도를 뜻한다

  - 명칭 커네이선스(CoN)
    여러 컴포넌트의 엔티티명이 일치해야한다

    메스드명이 코드베이스가 커플링되는 가장 일반적이고 바람직한 방법

  - 타입 커네이선스(CoT)
    여러 컴포넌트의 엔티티 타입이 일치해야한다

  - 의미 커네이선스(CoM) 또는 관례 커네이선스(CoC)
    여러 컴포넌트 간 어떤 값의 의미가 일치해야한다

    주로 상수 대신 값을 하드코딩한 코드베이스에서 흔히 발견된다

    ```
    int isTrue = 1;
    ```

    가령, 위처럼 선언된 경우, 이 값을 수정했을 경우 발생하는 문제

  - 위치 커네이선스(CoP)
    여러 컴포넌트의 값의 순서가 일치해야 한다

    일반적으로 메소드와 함수의 매개변수 값 처럼 순서가 지정된 것

  - 알고리즘 커네이선스(CoA)
    여러 컴포넌트 간 특정 알고리즘이 일치해야한다

    흔히 서버/클라이언트 간 유저 인증에 사용되는 알고리즘처럼 동일한 결과를 내야하는 것

- 동적 커네이선스

  - 실행 커네이선스(CoE)
    여러 컴포넌트의 실행 순서가 중요한 것
  - 시점 커네이선스(CoT)
    여러 컴포넌트의 실행 시점이 중요한 것

    흔히 경합 조건(Race condition)이 발생하여 공동 작업에 영향을 끼치는 것

  - 값 커네이선스(CoV)
    상호 연관된 다수의 값들을 함께 변경해야 하는 것

    분산 DB의 트랜잭션처럼, 모든 DB에서 특정 값을 업데이트해야 할 경우, 전체 값을 한번에 바꾸거나 아무것도 바꾸지 않아야 한다

  - 식별 커네이선스(CoI)
    여러 컴포넌트가 동일한 엔티티를 참조할 때 발생하는 것

    대표 사례는 두 컴포넌트가 분산 큐(Distributed queue) 자료 구조를 공유하여 업데이트 하는 경우

- 커네이선스 속성

  - 커네이선스 강도(Strength)

    리펙토링 용이성에 따라 커네이선스 강도가 결정된다

    - 동적 커네이선스는 파악하기 어렵다
    - 정적 커네이선스는 다양한 도구를 통해 어렵잖게 개선할 수 있다

  - 커네이선스 지역성(Locality)

    코드베이스의 모듈들이 서로 얼마나 가까이 위치하고 있는가

    근접한 코드(Proximal code)는 별개의 모듈 혹은 코드베이스로 분리된 코드보다 높은 형태의 커네이선스를 가진다

  - 커네이선스 정도(degree)

    커네이선스가 소수의 클래스에 영향을 미치는지 수많은 클래스에 영향을 미치는지 그 영향의 규모를 뜻한다

    이 값은 낮을 수록 코드베이스에 바람직하다

    일반적으로 코드베이스는 점점 커지기때문에 사소한 문제도 점점 악화된다

- 커네이선스를 이용해 시스템의 모듈성을 개선하는 법
  1. 시스템을 캡슐화한 요소들로 잘게 나누어 전체 커네이선스를 최소화한다
  2. 캡슐화 경계를 벗어나는 나머지 커네이선스를 모조리 최소화한다
  3. 캡슐화 경계 내부에서 커네이선스를 최대화한다

> 정도의 규칙 Rule of Degree
>
> 강한 형태의 커네이선스를 보다 약한 형태의 커네이선스로 전환하라
>
> - 짐 웨이리치 Jim Weirich

> 지역성의 규칙 Rule of Locality
>
> 소프트웨어 엘리먼트 간의 거리가 멀어질수록 보다 약한 형태의 커네이선스를 사용하라
>
> - 짐 웨이리치 Jim Weirich

### 3.2.6 커플링과 커네이선스 메트릭을 통합

아키텍트 관점에서 커플링과 커네이선스는 두가지 뷰가 서로 중첩된다

- 정적 커네이선스라고 정리한 것은 유출/유입 커플링 정도를 나타낸다

## 3.3 모듈에서 컴포넌트로

모듈이라는 표현을 많이 사용하였으나, 대부분의 플랫폼은 아키텍트에게 핵심 구성 요소 중 하나인 컴포넌트 형태로 지원한다
